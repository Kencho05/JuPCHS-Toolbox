Examples of port-controlled Hamiltonian Systems
## A second-order DC/DC converter: Buck

A DC/DC buck converter can also be represented as a port-controlled Hamiltonian system. In this case, the inductor and the capacitor define the stored energy, and the switching device and the load give the interconnection and the dissipation. Because of this structure, we can apply Hamiltonian tools to study and control the converter. Consider the following circuit:

![image](dcdc.svg)

We define state variables as $x_1=l i$, $x_2=cv$. The system input is the duty cycle of the swithc, i.e., $u=m$, and a Hamiltonian:

$$ H(x) = \frac{1}{2l}x_1^2 + \frac{1}{2c}x_2^2 $$

A square matrix $Q$ is defined as follows:

$$Q=\text{diag}\left(\frac{1}{l},\; \frac{1}{c}\right)$$

Then, $H$ can be written in a more compact representation: 

$$H(x) = \frac{1}{2}x^\top Q x$$

and,

$$\nabla H(x) = Qx$$

The dynamic model can be obtained by applying Kirchhoffâ€™s current and voltage laws and analyzing the circuit in both switching states. For instance:

**Switch ON (m = 1):**

$$
l\frac{di}{dt} = -v + v_0
\qquad
c\frac{dv}{dt} = i - \frac{v}{r}
$$

**Switch OFF (m = 0):**

$$
l\frac{di}{dt} = -v
\qquad
c\frac{dv}{dt} = i - \frac{v}{r}
$$

By combining both analyses, we obtain:

$$
l\frac{di}{dt} = -v + mv_0
\qquad
c\frac{dv}{dt} = i - \frac{v}{r}
$$

Expressed in the state variables

$$
\dot{x_1} = -\frac{x_2}{c} + u v_0
\qquad
\dot{x_2} = \frac{x_1}{l} - \frac{x_2}{cr}
$$

Reorganizing the equations, we obtain a PCHS

$$
R = \text{diag}\left(0,\; \frac{1}{r}\right)
\qquad
J = \begin{bmatrix}
0 & -1 \\
1 & 0 
\end{bmatrix}
\qquad
G = \begin{bmatrix}
v_0\\
0
\end{bmatrix} 
$$

Simulating this circuit in JuPCHS is quite simple, the parameters are $l = 15.91e-3$, $c = 50e-6$, $r = 25$, $v_0 = 24$. Then the PCHS is build as follows:

    Q = [1/l 0; 0 1/c]
    Js = [0 -1; 1 0]
    Rs = [0 0; 0 1/r]
    Gs = [v0; 0]
    Hs(x) = 0.5*(x'*(Q*x))
    dHs(x) = Q*x
    buck = BuildPCHS(nx=2,nu=1, dt=1/45e3, 
                    R= Rs, J=Js, H=Hs, dH=dHs,G=Gs,
                    name="buck",
                    xlabel=["li","cv"],
                    ulabel=["m"])

To obtain an output voltage of $12\,\mathrm{V}$, it is necessary to use a duty cycle of $0.5$, which means that $u = 0.5$. The simulation is performed using the functions provided in the package, where the state variables are scaled by $1/L$ and $1/C$, respectively.

    u_input(x,t) = [0.5*Heaviside(t-0.02)]
    results = Simulate(PCHS=buck,nt=4000,xini=[0;0],u=u_input,method="Euler")
    PlotResults(PCHS=buck,data=results,graph=["x","H"],xscale=[1/l;1/c])


---

Return to: [List of examples](CH05.md)
